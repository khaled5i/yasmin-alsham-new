# دليل الاختبار - نظام إدارة الصور والحقول الإضافية

## نظرة عامة

هذا الدليل يوضح كيفية اختبار الميزات الجديدة في نظام إدارة متجر الفساتين الجاهزة.

---

## الإعداد الأولي

### 1. تشغيل التطبيق

```bash
npm run dev
```

### 2. تسجيل الدخول كمدير

1. افتح `http://localhost:3000`
2. سجل دخول بحساب مدير
3. اذهب إلى لوحة التحكم: `/dashboard/ready-designs`

---

## اختبار 1: رفع الصور إلى Supabase Storage

### الهدف
التحقق من أن الصور يتم رفعها إلى Supabase Storage بنجاح مع ضغط تلقائي وإنشاء thumbnails.

### الخطوات

1. **افتح لوحة التحكم:**
   - اذهب إلى `/dashboard/ready-designs`
   - اضغط زر **"إضافة فستان جديد"**

2. **ارفع صورة:**
   - اضغط على منطقة رفع الصور أو اسحب صورة
   - اختر صورة JPG, PNG, أو WEBP (أقل من 5MB)

3. **راقب Progress Bar:**
   - يجب أن ترى شريط تقدم يظهر
   - الحالات المتوقعة:
     - "جاري الضغط..." (20-40%)
     - "جاري الرفع..." (60-80%)
     - "تم بنجاح" (100%)
   - أيقونة ✓ خضراء عند النجاح

4. **تحقق من Supabase Storage:**
   - افتح Supabase Dashboard
   - اذهب إلى Storage → product-images
   - افتح مجلد `products/` → يجب أن ترى الصورة
   - افتح مجلد `products/thumbnails/` → يجب أن ترى thumbnail

### النتيجة المتوقعة

✅ شريط تقدم يعمل بشكل صحيح
✅ الصورة مرفوعة في `products/`
✅ Thumbnail مرفوع في `products/thumbnails/`
✅ الصورة مضغوطة (حجم أقل من الأصلية)
✅ Thumbnail بأبعاد 300x400px

---

## اختبار 2: التحقق من الملفات

### الهدف
التحقق من أن النظام يرفض الملفات غير المدعومة أو الكبيرة جداً.

### الخطوات

#### اختبار 2.1: نوع ملف غير مدعوم

1. حاول رفع ملف PDF أو DOCX
2. **النتيجة المتوقعة:**
   - رسالة خطأ: "نوع الملف غير مدعوم. الأنواع المدعومة: JPG, PNG, WEBP"
   - الملف لا يُرفع

#### اختبار 2.2: ملف كبير جداً

1. حاول رفع صورة أكبر من 5MB
2. **النتيجة المتوقعة:**
   - رسالة خطأ: "حجم الملف كبير جداً. الحد الأقصى: 5.0MB"
   - الملف لا يُرفع

#### اختبار 2.3: ملفات صحيحة

1. ارفع صورة JPG (أقل من 5MB) ✅
2. ارفع صورة PNG (أقل من 5MB) ✅
3. ارفع صورة WEBP (أقل من 5MB) ✅
4. **النتيجة المتوقعة:**
   - جميع الصور تُرفع بنجاح

---

## اختبار 3: رفع عدة صور

### الهدف
التحقق من أن النظام يمكنه رفع عدة صور في نفس الوقت.

### الخطوات

1. اختر 3-5 صور دفعة واحدة
2. **النتيجة المتوقعة:**
   - شريط تقدم منفصل لكل صورة
   - جميع الصور تُرفع بالتوازي
   - Progress bars تتحرك بشكل مستقل
   - جميع الصور تظهر في المعاينة بعد النجاح

---

## اختبار 4: الحقول الإضافية

### الهدف
التحقق من أن الحقول الجديدة (fabric, features, occasions, care_instructions) تعمل بشكل صحيح.

### الخطوات

1. **في نموذج "إضافة فستان جديد":**

   - **نوع القماش:**
     ```
     حرير فاخر
     ```

   - **المميزات:**
     ```
     تطريز يدوي, أحجار كريستال, ذيل طويل, تصميم فرنسي
     ```

   - **المناسبات:**
     ```
     زفاف, خطوبة, حفلات رسمية
     ```

   - **تعليمات العناية:**
     ```
     تنظيف جاف فقط, لا تستخدم المبيض, كي بحرارة منخفضة, تخزين في مكان جاف
     ```

2. **املأ باقي الحقول المطلوبة:**
   - العنوان: "فستان زفاف كلاسيكي أبيض"
   - الوصف: "فستان زفاف فاخر بتصميم كلاسيكي..."
   - السعر: 5000
   - المقاسات: S, M, L
   - الألوان: أبيض, عاجي

3. **احفظ المنتج**

4. **افتح صفحة تفاصيل المنتج:**
   - اذهب إلى `/designs`
   - اضغط على المنتج الجديد

5. **تحقق من عرض المعلومات الإضافية:**
   - يجب أن ترى قسم "تفاصيل إضافية"
   - نوع القماش: "حرير فاخر"
   - المميزات: قائمة بـ 4 نقاط
   - المناسبات: 3 badges
   - تعليمات العناية: قائمة بـ 4 نقاط

### النتيجة المتوقعة

✅ جميع الحقول تُحفظ بشكل صحيح
✅ المميزات تُحول من نص إلى array
✅ المناسبات تُحول من نص إلى array
✅ تعليمات العناية تُحول من نص إلى array
✅ جميع المعلومات تظهر في صفحة التفاصيل بتنسيق جميل

---

## اختبار 5: التعديل

### الهدف
التحقق من أن تعديل المنتج يعمل مع الحقول الجديدة.

### الخطوات

1. في لوحة التحكم، اضغط "تعديل" على منتج موجود
2. عدّل الحقول الإضافية:
   - غيّر نوع القماش
   - أضف/احذف مميزات
   - أضف/احذف مناسبات
   - أضف/احذف تعليمات عناية
3. احفظ التعديلات
4. افتح صفحة التفاصيل
5. **النتيجة المتوقعة:**
   - جميع التعديلات محفوظة
   - المعلومات محدثة في صفحة التفاصيل

---

## اختبار 6: الأداء

### الهدف
التحقق من أن الصور المضغوطة و thumbnails تحسّن الأداء.

### الخطوات

1. **قبل الضغط:**
   - ارفع صورة كبيرة (مثلاً 3MB)
   - لاحظ الحجم الأصلي

2. **بعد الضغط:**
   - تحقق من حجم الصورة في Storage
   - **النتيجة المتوقعة:** حجم أقل (مثلاً 500KB-1MB)

3. **Thumbnails:**
   - افتح صفحة المتجر `/designs`
   - افتح Developer Tools → Network
   - لاحظ حجم الصور المحملة
   - **النتيجة المتوقعة:** thumbnails صغيرة (50-100KB)

4. **الصورة الكاملة:**
   - افتح صفحة تفاصيل المنتج
   - لاحظ حجم الصورة الكاملة
   - **النتيجة المتوقعة:** صورة مضغوطة ولكن بجودة جيدة

---

## اختبار 7: معالجة الأخطاء

### الهدف
التحقق من أن النظام يتعامل مع الأخطاء بشكل صحيح.

### السيناريوهات

#### سيناريو 1: Supabase غير متاح

1. أوقف Supabase أو غيّر URL خاطئ
2. حاول رفع صورة
3. **النتيجة المتوقعة:**
   - النظام يتحول تلقائياً إلى base64
   - رسالة تحذير في Console: "⚠️ Supabase غير مُكوّن - استخدام base64 كبديل"
   - الصورة تُحفظ كـ base64 في قاعدة البيانات

#### سيناريو 2: فشل الرفع

1. قطع الاتصال بالإنترنت أثناء الرفع
2. **النتيجة المتوقعة:**
   - Progress bar يتوقف
   - رسالة خطأ واضحة
   - أيقونة ❌ حمراء

#### سيناريو 3: حقول فارغة

1. حاول حفظ منتج بدون عنوان
2. **النتيجة المتوقعة:**
   - رسالة خطأ: "يرجى إدخال عنوان الفستان"
   - المنتج لا يُحفظ

---

## اختبار 8: التوافق مع المتصفحات

### الهدف
التحقق من أن الميزات تعمل على جميع المتصفحات.

### المتصفحات المدعومة

- ✅ Chrome/Edge (Chromium)
- ✅ Firefox
- ✅ Safari
- ✅ Mobile browsers (iOS Safari, Chrome Mobile)

### الخطوات

1. افتح التطبيق في كل متصفح
2. جرب رفع صورة
3. تحقق من Progress Bar
4. تحقق من عرض الحقول الإضافية

### النتيجة المتوقعة

✅ جميع الميزات تعمل على جميع المتصفحات
✅ التنسيق متسق
✅ لا توجد أخطاء في Console

---

## قائمة التحقق النهائية

### Supabase Storage

- [ ] Bucket `product-images` موجود
- [ ] Bucket public
- [ ] RLS policies موجودة (4 policies)
- [ ] الصور تُرفع إلى `products/`
- [ ] Thumbnails تُرفع إلى `products/thumbnails/`

### رفع الصور

- [ ] Progress Bar يعمل
- [ ] الضغط التلقائي يعمل
- [ ] Thumbnails تُنشأ تلقائياً
- [ ] التحقق من نوع الملف يعمل
- [ ] التحقق من حجم الملف يعمل
- [ ] رسائل الأخطاء واضحة

### الحقول الإضافية

- [ ] حقل نوع القماش يعمل
- [ ] حقل المميزات يعمل (array)
- [ ] حقل المناسبات يعمل (array)
- [ ] حقل تعليمات العناية يعمل (array)
- [ ] جميع الحقول تُحفظ بشكل صحيح
- [ ] جميع الحقول تظهر في صفحة التفاصيل

### الأداء

- [ ] الصور مضغوطة
- [ ] Thumbnails صغيرة
- [ ] التحميل سريع
- [ ] لا توجد مشاكل في الأداء

### معالجة الأخطاء

- [ ] الأخطاء تُعرض بشكل واضح
- [ ] النظام يتحول إلى base64 عند فشل Supabase
- [ ] التحقق من الحقول المطلوبة يعمل

---

## الإبلاغ عن المشاكل

إذا وجدت أي مشكلة أثناء الاختبار:

1. **سجّل المشكلة:**
   - ما هي الخطوات التي أدت إلى المشكلة؟
   - ما هي النتيجة المتوقعة؟
   - ما هي النتيجة الفعلية؟
   - هل هناك رسائل خطأ في Console؟

2. **التقط Screenshots:**
   - صورة للمشكلة
   - صورة لـ Console (F12)
   - صورة لـ Network tab

3. **تحقق من:**
   - هل Supabase مُكوّن بشكل صحيح؟
   - هل Storage Bucket موجود؟
   - هل RLS policies موجودة؟
   - هل المستخدم admin؟

---

**تاريخ الإنشاء:** 2025-11-01  
**آخر تحديث:** 2025-11-01  
**الحالة:** ✅ جاهز للاستخدام

