# ุฏููู ุชุฑุญูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฅูู ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ v2.0
# Database Migration Guide to v2.0

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ุจููุฉ ูุงุนุฏุฉ ุจูุงูุงุช ุดุงููุฉ ุฌุฏูุฏุฉ ููููุน ูุงุณููู ุงูุดุงู ุชุชุถูู:
- 14 ุฌุฏูู ุฑุฆูุณู ูุน ุนูุงูุงุช ูุญุณูุฉ
- ุณูุงุณุงุช ุฃูุงู ุดุงููุฉ (RLS)
- ููุงุฑุณ ูุชุญุณูู ุงูุฃุฏุงุก
- ุจูุงูุงุช ุชุฌุฑูุจูุฉ ุบููุฉ
- ุฎุฏูุงุช ุจุฑูุฌูุฉ ูุญุฏุซุฉ

## ๐๏ธ ุงููููุงุช ุงูุฌุฏูุฏุฉ

### ูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช:
- `supabase-schema-v2.sql` - ุงููุฎุทุท ุงูุดุงูู ุงูุฌุฏูุฏ
- `src/lib/database-v2.ts` - ุฎุฏูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญุฏุซุฉ
- `src/lib/database-safe-v2.ts` - ุงูุฎุฏูุงุช ุงูุขููุฉ ูุน ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ

### ูููุงุช ุงูุชูุซูู:
- `DATABASE-MIGRATION-GUIDE.md` - ูุฐุง ุงูุฏููู
- `DATABASE-TESTING-GUIDE.md` - ุฏููู ุงูุงุฎุชุจุงุฑ (ุณูุชู ุฅูุดุงุคู)

## ๐ ุฎุทูุงุช ุงูุชูููุฐ

### ุงูุฎุทูุฉ 1: ุชูููุฐ ุงููุฎุทุท ุงูุฌุฏูุฏ ูู Supabase

1. **ุงูุชุญ ูุญุฑุฑ SQL ูู Supabase:**
   - ุงุฐูุจ ุฅูู ููุญุฉ ุชุญูู Supabase
   - ุงุฎุชุฑ ูุดุฑูุนู
   - ุงุฐูุจ ุฅูู **SQL Editor**

2. **ูุณุฎ ูุชูููุฐ ุงููุฎุทุท:**
   ```sql
   -- ุงูุณุฎ ูุญุชูู ููู supabase-schema-v2.sql ุจุงููุงูู
   -- ูุงูุตูู ูู ูุญุฑุฑ SQL
   ```

3. **ุชูููุฐ ุงูููุฏ:**
   - ุงุถุบุท **Run** ุฃู `Ctrl+Enter`
   - ุงูุชุธุฑ ุญุชู ุธููุฑ ุฑุณุงูุฉ ุงููุฌุงุญ
   - ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก

### ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุฅูุดุงุก ุงูุฌุฏุงูู

1. **ุงุฐูุจ ุฅูู Table Editor:**
   - ุชุฃูุฏ ูู ูุฌูุฏ ุฌููุน ุงูุฌุฏุงูู ุงูุชุงููุฉ:
   ```
   โ users (ุงููุณุชุฎุฏููู)
   โ workers (ุงูุนูุงู)
   โ fabrics (ุงูุฃููุดุฉ)
   โ designs (ุงูุชุตุงููู)
   โ products (ุงูููุชุฌุงุช)
   โ appointments (ุงูููุงุนูุฏ)
   โ orders (ุงูุทูุจุงุช)
   โ order_items (ุนูุงุตุฑ ุงูุทูุจ)
   โ favorites (ุงูููุถูุฉ)
   โ cart_items (ุนุฑุจุฉ ุงูุชุณูู)
   โ notifications (ุงูุฅุดุนุงุฑุงุช)
   โ system_settings (ุฅุนุฏุงุฏุงุช ุงููุธุงู)
   โ worker_reviews (ุชููููุงุช ุงูุนูุงู)
   โ activity_log (ุณุฌู ุงูุฃูุดุทุฉ)
   ```

2. **ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ:**
   - ุงูุชุญ ูู ุฌุฏูู ูุชุฃูุฏ ูู ูุฌูุฏ ุงูุจูุงูุงุช
   - ูุฌุจ ุฃู ุชุฑู:
     - 5 ูุณุชุฎุฏููู ุชุฌุฑูุจููู
     - 2 ุนุงูู
     - 5 ุฃููุดุฉ
     - 4 ุชุตุงููู
     - 2 ููุนุฏ
     - 2 ุทูุจ
     - ูุจูุงูุงุช ุฃุฎุฑู...

### ุงูุฎุทูุฉ 3: ุชุญุฏูุซ ุงูููุฏ ุงูุจุฑูุฌู

1. **ุงุณุชุจุฏุงู ูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
   ```bash
   # ูุณุฎ ุงุญุชูุงุทูุฉ ูู ุงููููุงุช ุงููุฏููุฉ
   mv src/lib/database.ts src/lib/database-old.ts
   mv src/lib/database-safe.ts src/lib/database-safe-old.ts
   
   # ุงุณุชุฎุฏุงู ุงููููุงุช ุงูุฌุฏูุฏุฉ
   mv src/lib/database-v2.ts src/lib/database.ts
   mv src/lib/database-safe-v2.ts src/lib/database-safe.ts
   ```

2. **ุชุญุฏูุซ ุงูุงุณุชูุฑุงุฏุงุช ูู ุงููููุงุช:**
   - ุงุจุญุซ ุนู ุฌููุน ุงููููุงุช ุงูุชู ุชุณุชูุฑุฏ ูู `./database` ุฃู `./database-safe`
   - ุชุฃูุฏ ูู ุฃู ุงูุงุณุชูุฑุงุฏุงุช ุชุนูู ูุน ุงูุฃููุงุน ุงูุฌุฏูุฏุฉ

### ุงูุฎุทูุฉ 4: ุงุฎุชุจุงุฑ ุงููุธุงู

1. **ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู:**
   ```bash
   npm run dev
   ```

2. **ุงุฎุชุจุงุฑ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ:**
   - ุงูุชุญ http://localhost:3001
   - ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก ูู Console
   - ุชุญูู ูู ุนุฑุถ ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

3. **ุงุฎุชุจุงุฑ ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ:**
   - ุนุฑุถ ุงูุชุตุงููู
   - ุฅุถุงูุฉ ุฅูู ุงูููุถูุฉ
   - ุฅุถุงูุฉ ุฅูู ุนุฑุจุฉ ุงูุชุณูู
   - ุญุฌุฒ ููุนุฏ (ุฅุฐุง ูุงู ูุชุงุญุงู)

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ ูู ุชูููุฐ SQL:
```
ERROR: relation "table_name" already exists
```
**ุงูุญู:** ุงุญุฐู ุงูุฌุฏุงูู ุงูููุฌูุฏุฉ ุฃููุงู ุฃู ุงุณุชุฎุฏู `DROP TABLE IF EXISTS`

### ุฎุทุฃ ูู ุงูุฃุฐููุงุช:
```
ERROR: permission denied for schema public
```
**ุงูุญู:** ุชุฃูุฏ ูู ุฃู ูุฏูู ุตูุงุญูุงุช ุงููุฏูุฑ ูู ูุดุฑูุน Supabase

### ุฎุทุฃ ูู ุงูุงุณุชูุฑุงุฏ:
```
Module not found: Can't resolve './database-v2'
```
**ุงูุญู:** ุชุฃูุฏ ูู ุฅุนุงุฏุฉ ุชุณููุฉ ุงููููุงุช ุจุดูู ุตุญูุญ

### ุฎุทุฃ ูู ุงูุฃููุงุน:
```
Type 'X' is not assignable to type 'Y'
```
**ุงูุญู:** ุชุญูู ูู ุชุญุฏูุซ ุฌููุน ุงูุฃููุงุน ูู ุงูููุฏ

## ๐ ููุงุฑูุฉ ุงููุณุฎ

### ุงููุณุฎุฉ ุงููุฏููุฉ:
- 8 ุฌุฏุงูู ุฃุณุงุณูุฉ
- ุณูุงุณุงุช ุฃูุงู ุจุณูุทุฉ
- ุจูุงูุงุช ุชุฌุฑูุจูุฉ ูุญุฏูุฏุฉ
- ุฎุฏูุงุช ุฃุณุงุณูุฉ

### ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ v2.0:
- 14 ุฌุฏูู ุดุงูู
- ุณูุงุณุงุช ุฃูุงู ูุชูุฏูุฉ
- ุจูุงูุงุช ุชุฌุฑูุจูุฉ ุบููุฉ
- ุฎุฏูุงุช ูุญุณูุฉ ูุน ูุนุงูุฌุฉ ุฃุฎุทุงุก
- ููุงุฑุณ ูุชุญุณูู ุงูุฃุฏุงุก
- ูุธุงุฆู ูุณุงุนุฏุฉ ููุดุบูุงุช

## ๐ฏ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### ุฌุฏุงูู ุฌุฏูุฏุฉ:
- `fabrics` - ุฅุฏุงุฑุฉ ุงูุฃููุดุฉ
- `products` - ุงูููุชุฌุงุช ุงูุฌุงูุฒุฉ
- `order_items` - ุชูุงุตูู ุงูุทูุจุงุช
- `worker_reviews` - ุชููููุงุช ุงูุนูุงู
- `activity_log` - ุณุฌู ุงูุฃูุดุทุฉ
- `system_settings` - ุฅุนุฏุงุฏุงุช ุงููุธุงู

### ููุฒุงุช ูุญุณูุฉ:
- ูุธุงู ุชุฑููู ุชููุงุฆู ููุทูุจุงุช
- ุญุณุงุจ ุฅุฌูุงูู ุงูุทูุจ ุชููุงุฆูุงู
- ุชุชุจุน ุงููุดุงูุฏุงุช ููุชุตุงููู
- ูุธุงู ุชูููู ุงูุนูุงู
- ุฅุนุฏุงุฏุงุช ูุธุงู ูุฑูุฉ

### ุฃูุงู ูุญุณู:
- ุณูุงุณุงุช RLS ุดุงููุฉ ููู ุฌุฏูู
- ูุตู ุงูุฃุฐููุงุช ุญุณุจ ุงูุฃุฏูุงุฑ
- ุญูุงูุฉ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ
- ุชุณุฌูู ุงูุฃูุดุทุฉ

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ:**
   - ุงุญุชูุธ ุจูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุฏููุฉ
   - ุงุญุชูุธ ุจุงููููุงุช ุงููุฏููุฉ ููุฑุฌุน

2. **ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ:**
   - ุฅุฐุง ูุงู ูุฏูู ุจูุงูุงุช ูููุฉุ ูู ุจุชุฑุญูููุง ูุฏููุงู
   - ุงุณุชุฎุฏู ุฃุฏูุงุช ุงูุชุตุฏูุฑ/ุงูุงุณุชูุฑุงุฏ ูู Supabase

3. **ุงูุงุฎุชุจุงุฑ:**
   - ุงุฎุชุจุฑ ุฌููุน ุงููุธุงุฆู ูุจู ุงููุดุฑ
   - ุชุฃูุฏ ูู ุนูู ุฌููุน ุงูุตูุญุงุช
   - ุงุฎุชุจุฑ ูู ุจูุฆุงุช ูุฎุชููุฉ

4. **ุงูุฃุฏุงุก:**
   - ุฑุงูุจ ุฃุฏุงุก ุงูุงุณุชุนูุงูุงุช
   - ุงุณุชุฎุฏู ุงูููุงุฑุณ ุงูููุงุณุจุฉ
   - ุฑุงุฌุน ุฎุทุท ุงูุชูููุฐ ููุงุณุชุนูุงูุงุช ุงููุนูุฏุฉ

## ๐ ุงูุนูุฏุฉ ูููุณุฎุฉ ุงููุฏููุฉ

ุฅุฐุง ูุงุฌูุช ูุดุงููุ ููููู ุงูุนูุฏุฉ ูููุณุฎุฉ ุงููุฏููุฉ:

```bash
# ุงุณุชุนุงุฏุฉ ุงููููุงุช ุงููุฏููุฉ
mv src/lib/database.ts src/lib/database-v2.ts
mv src/lib/database-safe.ts src/lib/database-safe-v2.ts
mv src/lib/database-old.ts src/lib/database.ts
mv src/lib/database-safe-old.ts src/lib/database-safe.ts

# ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู
npm run dev
```

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ูุดุงูู:
1. ุชุญูู ูู **Logs** ูู Supabase
2. ุฑุงุฌุน **Console** ูู ุงููุชุตูุญ
3. ุชุฃูุฏ ูู ุตุญุฉ ูุชุบูุฑุงุช ุงูุจูุฆุฉ
4. ุฑุงุฌุน ูุฐุง ุงูุฏููู ูุฑุฉ ุฃุฎุฑู

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2025-01-11  
**ุงููุณุฎุฉ:** 2.0  
**ุงูุญุงูุฉ:** ุฌุงูุฒ ููุชูููุฐ
